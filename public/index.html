<!DOCTYPE html>
<html>
<head>
  <title>De Koen Quiz ðŸŽ„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: "Inter", sans-serif;
      background: linear-gradient(135deg, #fff0f0, #ffeaea);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    .garland {
      position: absolute;
      top: 0;
      width: 100%;
      height: 60px;
      background: repeating-linear-gradient(
        45deg,
        red,
        red 10px,
        white 10px,
        white 20px
      );
      z-index: 1;
    }

    .presents {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
    }

    .present {
      width: 50px;
      height: 50px;
      background: red;
      border: 3px solid white;
      border-radius: 8px;
      position: relative;
      animation: bounce 2s infinite alternate;
    }

    .present:nth-child(2) { background: #ff5555; animation-delay: 0.2s; }
    .present:nth-child(3) { background: #ff7777; animation-delay: 0.4s; }

    @keyframes bounce {
      from { transform: translateY(0); }
      to { transform: translateY(-10px); }
    }

    .layout {
      display: flex;
      gap: 28px;
      align-items: stretch;
      align-items: stretch;
      width: 100%;
      max-width: 1000px;
      z-index: 2;
      position: relative;
    }

    /* LEFT IMAGE COLUMN (was .left-ad) */
    .promo-box {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .promo-box img {
      width: 100%;
      max-width: 420px;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(20,30,70,0.15);
      object-fit: cover;
    }

    /* QUIZ CARD */
    .quiz-card {
      background: white;
      padding: 35px 40px;
      border-radius: 20px;
      width: 420px;
      box-shadow: 0px 10px 40px rgba(0, 0, 0, 0.15);
      text-align: center;
      animation: fadeIn 0.4s ease;
      border: 3px solid red;
    }

    /* SNOW CONTAINER */
.snow {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none; /* don't block clicks */
  overflow: hidden;
  z-index: 9999;
}

/* Individual snowflake */
.snowflake {
  position: absolute;
  top: -10px;
  font-size: 1em;
  color: white;
  opacity: 0.9;
  user-select: none;
  animation-name: fall;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
}

@keyframes fall {
  0% { transform: translateY(-10px) rotate(0deg); }
  100% { transform: translateY(110vh) rotate(360deg); }
}


    @media (max-width: 880px) {
      .layout { flex-direction: column-reverse; align-items: center; }
      .quiz-card { width: 100%; max-width: 600px; }
      .promo-box img { max-width: 280px; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      margin-top: 0;
      font-size: 28px;
      color: red;
    }

    #question {
      font-size: 20px;
      margin: 20px 0 25px;
      color: #a60000;
      font-weight: 600;
    }

    input, textarea {
      width: 100%;
      padding: 12px 14px;
      margin-top: 10px;
      border-radius: 12px;
      border: 1px solid #ffcccc;
      font-size: 16px;
      outline: none;
      transition: 0.2s;
      font-family: inherit;
    }

    textarea { resize: vertical; min-height: 80px; max-height: 250px; }

    input:focus, textarea:focus { border-color: red; box-shadow: 0 0 0 3px rgba(255,0,0,0.2); }

    #choices button {
      padding: 10px 16px;
      margin: 5px;
      border-radius: 12px;
      font-size: 15px;
      border: none;
      cursor: pointer;
      background: #ffeaea;
      color: red;
      transition: 0.2s;
    }

    #choices button:hover { background: #ffd6d6; transform: translateY(-2px); }

    button.submit-btn {
      width: 100%;
      margin-top: 15px;
      padding: 14px;
      border: none;
      background: red;
      color: white;
      font-size: 17px;
      border-radius: 14px;
      cursor: pointer;
      transition: 0.2s;
    }

    button.submit-btn:hover { background: #a60000; transform: translateY(-2px); }

    .credits {
      margin-top: 18px;
      font-size: 13px;
      color: #4b4b4b;
      opacity: 0.9;
    }

    a.sheet-link { color: red; text-decoration: underline; font-size: 13px; }
  </style>
</head>
<body>
  <div class="garland"></div>
  <div class="presents">
    <div class="present"></div>
    <div class="present"></div>
    <div class="present"></div>
  </div>

  <!-- Autoplay Christmas music -->
  <audio autoplay loop>
    <source src="music/christmas-music.mp3" type="audio/mpeg">
  </audio>

  <div class="layout">
    <!--<div class="promo-box">
      <img id="promoImage" src="" alt="" style="display:none" />
    </div> -- -->

    <div class="quiz-card">
      <h1>De Koen Quiz</h1>

      <div id="question">Loading today's question...</div>
      <div id="choices"></div>

      <input id="username" placeholder="Your name" />
      <textarea id="answer" placeholder="Your answer" rows="4"></textarea>

      <button class="submit-btn" onclick="submitAnswer()">Submit</button>

      <div class="credits">
        <a class="sheet-link" href="#" id="sheetLink" target="_blank">link naar spreadsheet</a><br>
        website gemaakt door <b>Tamir Boesjes</b><br>
        vragen door <b>Koen van Dijk</b>
      </div>
    </div>
  </div>

  <script>
    let currentQuestionId = null;

    async function loadQuestion() {
      try {
        const res = await fetch("/question");
        const data = await res.json();
        currentQuestionId = data.id;

        document.getElementById("question").innerText =
          data.question || "No question found.";

        const choicesDiv = document.getElementById("choices");
        choicesDiv.innerHTML = "";

        if (data.choices) {
          data.choices.split(",").forEach(choice => {
            const btn = document.createElement("button");
            btn.innerText = choice.trim();
            btn.onclick = () =>
              (document.getElementById("answer").value = choice.trim());
            choicesDiv.appendChild(btn);
          });
        }
      } catch (err) {
        console.error("Failed to load question:", err);
      }
    }

    async function loadPromo() {
      try {
        const res = await fetch("/promo");
        const json = await res.json();

        if (json.image) {
          const img = document.getElementById("promoImage");
          img.src = json.image;
          img.style.display = "block";
        }
      } catch (err) {
        console.error("Failed to load image:", err);
      }
    }

    async function submitAnswer() {
      const user = document.getElementById("username").value.trim();
      const answer = document.getElementById("answer").value.trim();

      if (!user || !answer || !currentQuestionId) {
        alert("Please enter your name and answer!");
        return;
      }

      try {
        const res = await fetch("/answer", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            user_name: user,
            answer,
            question_id: currentQuestionId,
          }),
        });

        const data = await res.json();

        if (res.ok) {
          alert("Answer submitted!");
          document.getElementById("answer").value = "";
          document.getElementById("username").value = "";
        } else {
          alert("Failed: " + (data.error || "unknown"));
        }
      } catch (err) {
        console.error(err);
        alert("Failed to submit answer.");
      }
    }

    document.getElementById("sheetLink").href =
      "https://docs.google.com/spreadsheets/d/1eJLd2rerfazwQDozdF-bKxNfr068Lb6TfOXEwplCElA";

    loadQuestion();
    loadPromo();
  </script>

  <div class="snow"></div>
  <script src="snow.js"></script>
</body>
</html>
